<html>
 <head> 
  <meta charset="utf-8" /> 
  <meta name="viewport" content="width=device-width,initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" /> 
  <meta name="format-detection" content="telephone=no" /> 
  <meta name="msapplication-tap-highlight" content="no" /> 
  <meta http-equiv="Pragma" content="public" /> 
  <meta http-equiv="Cache-Control" content="public" /> 
  <title>69312号三公房间</title> 
  <link rel="stylesheet" type="text/css" href="css/bullshop.css" /> 
  <link rel="stylesheet" type="text/css" href="css/sangong-1.0.0.css" /> 
  <link rel="stylesheet" type="text/css" href="css/alert-1.1.css" /> 
  <link rel="stylesheet" type="text/css" href="css/sangong6.css" /> 
  <script type="text/javascript" src="https://gameoss.fexteam.com/files/js/fastclick.js"></script> 
 <script type="text/javascript">
	window.addEventListener('load', function() {
		FastClick.attach(document.body);
	}, false);
  </script> 
 </head> 
 <body> 
 
  <div id="app-main" class="main" style="position: relative; width: 100%; margin: 0px auto; background: rgb(255, 255, 255); height:100%;">
   <div style="position: absolute; background-color: rgba(0, 0, 0, 0.8); width: 100%; height: 7vh; line-height: 7vh; color: white; font-size: 2.5vh; overflow: hidden; z-index: 9998; display: none;">
    <img src="img/img/alert_icon.png" style="position: absolute; top: 1.5vh; left: 3vw; width: 4vh; height: 4vh;" />
   </div> 








  <img src="/app/sangong6.png" style="display: none">
<img src="/app/dyj.png" style="display: none">
    <div id="overtime" style="display: none">
    <canvas id="myCanvas" width="800" height="1297" style="display: none"></canvas>
    </div>
<if condition="$room['endtime'] gt 0">
   <php>
      $mapxx=array();
      $mapxx['uid']=$user['id'];
      $mapxx['room']=$room['id'];
      if(M('user_room')->where($mapxx)->find()){
  </php>
    <script type="text/javascript">
        var data={};
        data.id={$room['id']};
        data.zjs={$room['zjs']};
        data.time='{$room['time']|date="Y-m-d H:i:s",###}';
        data.user={$room['overxx']};
        overroom(data);
    </script>

   <php>
     }
     else{
  </php>
  <div id="valert2" class="alert">
   <div class="alertBack"></div> 
   <div class="mainPart" style="height: 27%;margin-top: -113.39px;">
    <div class="backImg">
     <div class="blackImg" style="height: 82%;"></div>
    </div> 
    <div class="alertText" style="top: 45%;" id="tipmsg">房间已经关闭</div> 
     
     
   </div>
  </div>
  <php>
      }
      exit();
  </php>
</if>


<if condition="$fzuser['sfgl']  && (!$mayuser[$user['id']])">
<div id="valert2" class="alert">
   <div class="alertBack"></div> 
   <div class="mainPart" style="height: 27%;margin-top: -113.39px;">
    <div class="backImg">
     <div class="blackImg" style="height: 82%;"></div>
    </div> 
    <div class="alertText" style="top: 45%;" id="tipmsg">无法加入，请联系管理员。</div> 
     
     
   </div>
  </div>

  <php>
      exit();
  </php>
</if>

<if condition="count($room['userlist']) egt 9 && $room['userlist'][$user['id']] neq 1">
<div id="valert2" class="alert">
   <div class="alertBack"></div> 
   <div class="mainPart" style="height: 31%;margin-top: -113.39px;">
    <div class="backImg">
     <div class="blackImg" style=" height: 59%;"></div>
    </div> 
    <div class="alertText" style="top: 35%;" id="tipmsg">房间人数已满</div> 
     <div class="buttonRight" style="left: 31.5%;width: 17vh;height: 5.5vh;" onclick="location.href='/'">
     返回首页
    </div>
     
   </div>
  </div>

  <php>
      exit();
  </php>
</if>

   <div class="roomCard">
    <img src="/app/img/game/roomCard.png" /> 
    <div class="num">
     <div class='sangong-fk'></div> 
     <div class='sangong-fk1' id="fknum">{$user['fk']}张</div>
    </div>
   </div>

   <div class="round" style="" id="jsxx">
    {$room.js}&nbsp;/&nbsp;{$room.zjs}局
   </div> 
   <img src="img/sangong/home.png" class="return" style="right: 10px;" onclick="opnemm('fangjian_fanhuisy','tishi')" /> 
   <img src="img/sangong/note4.png" class="return" style="right: 60px;" onclick="opnemm('fangjian_tishi','tishi')" /> 
   <img src="img/sangong/footer_bull.png" usemap="#planetmap" class="bottom" /> 
   <img src="img/sangong/icon_game_rule.png" class="bottomGameRule" style="z-index: 110;" onclick="opnemm('fangjian_gz','vroomRule')"/> 
   <img src="img/sangong/icon_sound61.png" class="bottomGameIntro" style="z-index: 110;" 
   onclick="opnemm('fangjian_yinyue','vaudioRoom')"/> 
   <img src="img/sangong/icon_game_message.png" class="bottomGameMessage"  onclick="opnemm('fangjian_kj','message')"/> 
   <img src="img/sangong/btn_play_rule.png" class="bottomGameHistory" style="z-index: 110;" />

   <div class="myCardType" style="overflow: hidden;">
    <div id="df" style="overflow: hidden;">
     底分：{$room.df}
    </div>
   </div> 



  <div id="messageSay"></div>
  
  <div id="tishi" class="alert" style="display: none;"></div>   
  <div id="vaudioRoom" class="audioRoom" style="display: none;"></div> 
  <div id="vroomRule" class="createRoom" style="display: none;"></div>
  <div id='message' class="message" style="display: none;"></div> 





   <div id="table" class="table" style="position: relative; width:100%; height:100%; z-index: 80; overflow: hidden;">
    <img src="img/sangong/table6.jpg" class="tableBack" style="position: absolute; top: 0px; left: 0px; width: 100%; height: 100%;" />


    <div class="cardDeal" id="userfp" style="position: absolute; top: 19.5%; left: 19%; width: 62%; height: 55.5%;">
      <div class="myCards" style="display: none;"></div> 
      <div class="myCards" style="display: none;"></div>
      <div class="myCards" style="display: none;"></div>
    </div> 




    <div class="cardOver" style="position: absolute; top: 19.5%; left: 19%; width: 62%; height: 55.5%; overflow: hidden;"></div> 
    <!---->



    <div id="memberRobText"></div>
    
    <div id="memberTimesText"></div> 
    <div id="memberTimesText2"></div> 
    
    <div class="memberBull1" style="display: none;"></div>



    <div id="memberScoreText1"></div>

    <div id="member"></div> 

    <div id="jinbi"></div> 
    
  
   

  <div id="divRobBankerText"></div> 
    


    <div id="" class="clock" style="position: absolute; top: 38%; left: 0;right: 0;margin: auto; width: 40px; height: 42px; display: none;">
     <img src="img/sangong/bull_clock.png" style="position: absolute; width: 100%; height: 100%;" /> 
     <p style="position: absolute; top: 0px; left: 0px; width: 40px; height: 42px; color: white; text-align: center; line-height: 42px;"> -1 </p>
    </div> 


    <div id="operationButton" style="position: absolute; top: 53%; left: 5%; width:100%; height: 12vh; overflow: hidden;"></div> 
  </div> 
















  <script>
    function joinroom(){
      $("#valert").remove();
      token='{$token}';
      room='{$room.id}';
      var dkxx='{$room.dk}';
     load('show');
     if(dkxx){
      connect(dkxx);
    }
    else{
      load('hide');
      prompt('服务器没开启,请稍后再试');
      setTimeout("$('body').hide()",3000);
    }
    }
  </script>

<if condition="(count($room['userlist']) gt 0 && $room['js'] eq 0) || ($room['js'] gt 0 && !$room['userlist'][$user['id']])">
  <div id="valert" class="alert">
   <div class="alertBack"></div> 
   <div class="mainPart" style=" margin-top: -176.865px;">
    <div class="backImg">
     <div class="blackImg" style=" height: 77%;"></div>
    </div> 
    <div class="id">
     <img src="/app/img/ID.png" /> 
     <div class="text">
       你的九方ID:{$user.id} 
     </div>
    </div>
    <php>
      $count=M('user_room')->where(array('uid'=>$user['id']))->count();
      $count=$count+1;
      $max=M('user_room')->where(array('uid'=>$user['id']))->order('jifen desc')->find();
    </php> 
    <div class='lishijilu' style="">
    <div>历史最高分：<if condition="$max">{$max.jifen} ({$max.overtime|date="m-d H:i",###})<else/>暂无游戏记录</if></div>  
    <div>游戏总局数：{$count}</div> 
    </div>
    <div class="alertText" style="top: 1vh;">
     <div class="rull" style="font-size: 2.2vh;">
       模式
      <a>{$room['wfname']}</a> <br />
      <if condition="$room['df']">
       底分：
      <a>{$room['df']}</a> 
      <br /> 
      </if>
      <if condition="$room['gz']">
      规则： 
      <a>{$room['gz']}</a> 
      <br />
      </if> 
      <if condition="$room['px']">
       牌型： 
      <a><foreach name="room['px']" item="one">{$one}</foreach></a> 
      <br />
      </if> 

      <if condition="$room['sz']">
      上庄： 
      <a>{$room['sz']}</a> 
      <br />
      </if> 
            
       局数： 
      <a>{$room['zjs']}局X{$room['fk']}房卡 </a> 

     </div> 
     <div style="margin-bottom: 3vh;">
      房间中有<php>
          foreach($room['userlist'] as $key=>$one){
          if(!$indexxx)
          {
          $indexxx=1;
          }
          else{
          echo ',';
          }
          echo username($key);
          }
      </php>,是否加入？
     </div>
    </div> 
    
    <div style="position: relative;
    width: 100%;
    height: 13vh;
        top: 1vh;">
     <div class="buttonLeft" onclick="location.href='/'" style="    top: 0;
    bottom: 0;
    margin: auto;">
      创建房间
     </div> 
     <div class="buttonRight" onclick="joinroom()" style="   top: 0;
    bottom: 0;
    margin: auto;">
      加入游戏
     </div>
   </div>
  </div> 
</div>
<else/>
<script>
  joinroom();
</script>
</if> 








<audio onended="mp3playandpause('mp3niu0');" id="mp3niu0" src="/app/video/0.m4a"></audio>
<audio onended="mp3playandpause('mp3niu1');" id="mp3niu1" src="/app/video/1.m4a"></audio>
<audio onended="mp3playandpause('mp3niu2');" id="mp3niu2" src="/app/video/2.m4a"></audio>
<audio onended="mp3playandpause('mp3niu3');" id="mp3niu3" src="/app/video/3.m4a"></audio>
<audio onended="mp3playandpause('mp3niu4');" id="mp3niu4" src="/app/video/4.m4a"></audio>
<audio onended="mp3playandpause('mp3niu5');" id="mp3niu5" src="/app/video/5.m4a"></audio>
<audio onended="mp3playandpause('mp3niu6');" id="mp3niu6" src="/app/video/6.m4a"></audio>
<audio onended="mp3playandpause('mp3niu7');" id="mp3niu7" src="/app/video/7.m4a"></audio>
<audio onended="mp3playandpause('mp3niu8');" id="mp3niu8" src="/app/video/8.m4a"></audio>
<audio onended="mp3playandpause('mp3niu9');" id="mp3niu9" src="/app/video/9.m4a"></audio>
<audio onended="mp3playandpause('mp3sangong');" id="mp3niu10" src="/app/video/special5.m4a"></audio>
<audio onended="mp3playandpause('mp3xiaosangong');" id="mp3niu11" src="/app/video/special6.m4a"></audio>
<audio onended="mp3playandpause('mp3dasangong');" id="mp3niu12" src="/app/video/special7.m4a"></audio>
<audio onended="mp3playandpause('mp3jigong');" id="mp3niu13" src="/app/video/special8.m4a"></audio>
<audio onended="mp3playandpause('mp3leigong');" id="mp3niu13" src="/app/video/special9.m4a"></audio>
<audio onended="mp3playandpause('mp3tiangong');" id="mp3niu13" src="/app/video/special10.m4a"></audio>
<audio onended="mp3playandpause('mp3baojiu');" id="mp3niu13" src="/app/video/special11.m4a"></audio>

<audio onended="mp3playandpause('mp3daojishi');" id="mp3daojishi" src="/app/video/daojishi.mp3"></audio>
<audio onended="mp3playandpause('mp3gold');" id="mp3gold" src="/app/video/gold.mp3"></audio>
<audio onended="mp3playandpause('mp3kaiju');" id="mp3kaiju" src="/app/video/kaiju.mp3"></audio>
<audio onended="mp3playandpause('mp3xiazhu');" id="mp3xiazhu" src="/app/video/xiazhu.mp3"></audio>
<audio onended="mp3playandpause('mp3fapai');" id="mp3fapai" src="/app/video/fapai.mp3"></audio>

<audio onended="mp3playandpause('message1');" id="message1" src="/app/message/message1.mp3"></audio>
<audio onended="mp3playandpause('message2');" id="message2" src="/app/message/message2.mp3"></audio>
<audio onended="mp3playandpause('message3');" id="message3" src="/app/message/message3.mp3"></audio>
<audio onended="mp3playandpause('message4');" id="message4" src="/app/message/message4.mp3"></audio>
<audio onended="mp3playandpause('message5');" id="message5" src="/app/message/message5.mp3"></audio>
<audio onended="mp3playandpause('message6');" id="message6" src="/app/message/message6.mp3"></audio>
<audio onended="mp3playandpause('message7');" id="message7" src="/app/message/message7.mp3"></audio>
<audio onended="mp3playandpause('message8');" id="message8" src="/app/message/message8.mp3"></audio>
<audio onended="mp3playandpause('message9');" id="message9" src="/app/message/message9.mp3"></audio>
<audio onended="mp3playandpause('message10');" id="message10" src="/app/message/message10.mp3"></audio>
<audio onended="mp3playandpause('message11');" id="message11" src="/app/message/message11.mp3"></audio>


<audio id="background" src="/app/video/background8.mp3" ></audio>
<!--下注抢庄-->
<audio onended="mp3playandpause('xia1');" id="xia1" src="/app/video/zhuang/1.mp3"></audio>
<audio onended="mp3playandpause('xia2');" id="xia2" src="/app/video/zhuang/2.mp3"></audio>
<audio onended="mp3playandpause('xia4');" id="xia4" src="/app/video/zhuang/4.mp3"></audio>
<audio onended="mp3playandpause('xia5');" id="xia5" src="/app/video/zhuang/5.mp3"></audio>
<audio onended="mp3playandpause('qiangzhuang');" id="qiangzhuang" src="/app/video/zhuang/qiangzhuang.mp3"></audio>
<audio onended="mp3playandpause('buqiang');" id="buqiang" src="/app/video/zhuang/buqiang.mp3"></audio>

<script>




function over(msg){
  var html='<div id="valert2" class="alert">';
  html=html+'<div class="alertBack"></div> '; 
  html=html+'<div class="mainPart" style="height: 31%;margin-top: -113.39px;">'; 
  html=html+'<div class="backImg">'; 
  html=html+'<div class="blackImg" style="height: 59%;"></div>'; 
  html=html+'</div> '; 
  html=html+'<div class="alertText" style="top: 35%;" id="tipmsg">'+msg+'</div>'; 
  html=html+'<div class="buttonRight" style="left: 31.5%;width: 17vh;height: 5.5vh;" onclick="location.href='/'">返回首页</div> </div></div>'; 
  $('body').html(html);
}
var overscroll = function(el) {
  el.addEventListener('touchstart', function() {
    var top = el.scrollTop
      , totalScroll = el.scrollHeight
      , currentScroll = top + el.offsetHeight;
    //If we're at the top or the bottom of the containers
    //scroll, push up or down one pixel.
    //
    //this prevents the scroll from "passing through" to
    //the body.
    if(top === 0) {
      el.scrollTop = 1;
    } else if(currentScroll === totalScroll) {
      el.scrollTop = top - 1;
    }
  });
  el.addEventListener('touchmove', function(evt) {
    //if the content is actually scrollable, i.e. the content is long enough
    //that scrolling can occur
    if(el.offsetHeight < el.scrollHeight)
      evt._isScroller = true;
  });
}
document.body.addEventListener('touchmove', function(evt) {
  //In this case, the default behavior is scrolling the body, which
  //would result in an overflow.  Since we don't want that, we preventDefault.
  if(!evt._isScroller) {
    evt.preventDefault();
  }
});

var context = new (window.AudioContext || window.webkitAudioContext)();
var source = [];
var audioBuffer = [];

    function mp3play(id){
      if(id!='background' &&　mp3open==2){
        return false;
      }
        //document.getElementById(id).play();
        if(!audioBuffer[id]){
           loadAudioFile(id);
        }
        if(source[id]){
          source[id].stop()
        }
        source[id] = context.createBufferSource();
        source[id].buffer = audioBuffer[id];
        if(id=='background'){
            source[id].loop = true;
        }
        else{
          source[id].loop = false;
        }
        source[id].connect(context.destination);
        source[id].start(0); //立即播放
    }
    function mp3pause(id){
        //document.getElementById(id).pause();
        if (source[id]) {
          source[id].stop(); //立即停止
        }
    }

    function mp3playandpause(id){
        mp3play(id);
        mp3pause(id);
    }


function initSound(arrayBuffer,id) {
    context.decodeAudioData(arrayBuffer, function(buffer) { //解码成功时的回调函数
        audioBuffer[id] = buffer;
    }, function(e) { //解码出错时的回调函数
        console.log('Error decoding file', e);
    });
}


function loadAudioFile(id) {
    var url=$('#'+id).attr('src');
    var xhr = new XMLHttpRequest(); //通过XHR下载音频文件
    xhr.open('GET', url, true);
    xhr.responseType = 'arraybuffer';
    xhr.onload = function(e) { //下载完成
        initSound(this.response,id);
    };
    xhr.send();
}


    function audioAutoPlay(id){
        loadAudioFile(id);
    }
function muiscready(){
    audioAutoPlay('mp3niu0');
    audioAutoPlay('mp3niu1');
    audioAutoPlay('mp3niu2');
    audioAutoPlay('mp3niu3');
    audioAutoPlay('mp3niu4');
    audioAutoPlay('mp3niu5');
    audioAutoPlay('mp3niu6');
    audioAutoPlay('mp3niu7');
    audioAutoPlay('mp3niu8');
    audioAutoPlay('mp3niu9');
    audioAutoPlay('mp3niu10');
    audioAutoPlay('mp3niu11');
    audioAutoPlay('mp3niu12');
    audioAutoPlay('mp3niu13');
    audioAutoPlay('background');

    audioAutoPlay('mp3daojishi');
    audioAutoPlay('mp3gold');
    audioAutoPlay('mp3kaiju');
    audioAutoPlay('mp3xiazhu');

    audioAutoPlay('mp3fapai');



    audioAutoPlay('message1');
    audioAutoPlay('message2');
    audioAutoPlay('message3');
    audioAutoPlay('message4');
    audioAutoPlay('message5');
    audioAutoPlay('message6');
    audioAutoPlay('message7');
    audioAutoPlay('message8');
    audioAutoPlay('message9');
    audioAutoPlay('message10');
    audioAutoPlay('message11');


    audioAutoPlay('xia1');
    audioAutoPlay('xia2');
    audioAutoPlay('xia4');
    audioAutoPlay('xia5');
    audioAutoPlay('qiangzhuang');
    audioAutoPlay('buqiang');
if(bgmp3open==1){
setTimeout(function(){
    mp3pause('background');
    mp3play('background');
},2000)
}
 if(bgmp3open==2){
     mp3pause('background');
  }
}

        

// document.addEventListener("WeixinJSBridgeReady", function () {
//           mp3play('background');
// }, false);
// document.addEventListener('YixinJSBridgeReady', function() {
//           mp3play('background');      
// }, false);




function onBridgeReady(){
 WeixinJSBridge.invoke('getNetworkType',{},
    function(e){
        //WeixinJSBridge.log(e.err_msg);
         mp3play('mp3daojishi');  
      });
}

if (typeof WeixinJSBridge == "undefined"){
    if( document.addEventListener ){
        document.addEventListener('WeixinJSBridgeReady', onBridgeReady, false);
    }else if (document.attachEvent){
        document.attachEvent('WeixinJSBridgeReady', onBridgeReady); 
        document.attachEvent('onWeixinJSBridgeReady', onBridgeReady);
    }
}else{
    onBridgeReady();
}


muiscready();

</script>
 </body>
</html>


















function sss(data){
    var indexuser=data-index-(-1);
    if(indexuser<=0){
        indexuser=indexuser-(-12);
    }

    clearTimeout(ji);
        // $('.shiren-background').hide();
     //        $("#bankerAnimate"+indexuser).show(),
     //         $('.member'+indexuser+' .shiren-background2').hide()
     //         $('.member'+indexuser+' #bankerAnimate1'+indexuser).show()


                $('.shiren-background').hide();
        $("#bankerAnimate"+indexuser).show();
              // $('.member'+indexuser+' #bankerAnimate1'+indexuser).show()

             $("#bankerAnimate1"+indexuser).animate({
                top: "-1vh",
                left: "-1vh",
                width: "9.26vh",
                height: "9.26vh"
            },
            400,
            function() {
                $("#bankerAnimate1"+indexuser).animate({
                    top: "-0.1vh",
                    left: "-0.1vh",
                    width: "7.46vh",
                    height: "7.46vh"
                },
                400,
                function() {
                  $('.member'+indexuser+' .jiurenniuniu-background').hide();
                  $('.member'+indexuser+' .jiurenniuniu-background1').show();
                    
                })
            }),
            $("#bankerAnimate"+indexuser).animate({
                top: "-1vh",
                left: "-0.8vh",
                width: "7.8vh",
                height: "7.8vh"
            },400),
                $("#bankerAnimate"+indexuser).animate({
                    top: "-0.1vh",
                    left: "-0.1vh",
                    width: "6.4vh",
                    height: "6.4vh"
              },400)

        }
